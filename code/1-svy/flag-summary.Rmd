---
title: "Summarize CO Ipsos survey flagging of suspicious responses"
date: '`r strftime(Sys.time(), format = "%B %d, %Y")`'
output: github_document
---

```{r setup, message=FALSE}
library(tidyverse)
knitr::opts_chunk$set(comment = NA)
```

```{r}
svy <- readRDS("../../data-work/1-svy/svy-reshape.rds")
flags <- readRDS("../../data-work/1-svy/svy-flag.rds")
```

## Overview

A set of tests were run to flag respondents for possible removal from survey analysis, based on suspicious responses. Each instance of a suspicious response is assigned a defined flag value, and flags sum (i.e., a respondent can accumulate multiple flags). We recommend removal of respondents as invalid if crossing a threshold of acceptable flags.

### Flags used

Only respondents with `Vrid == "Complete"` surveys are examined here, of which there are `r filter(svy$person, Vstatus == "Complete") %>% nrow()` observations.

```{r}
# counts by flag
cnt <- flags$flag_values %>% count(flag_name)
left_join(flags$flag_details, cnt, by = "flag_name") %>%
    knitr::kable()
```

### Core Flags

Core flags are those marked core_suspicious in the first table.

```{r}
flags$flag_values %>%
    filter(group == "core_suspicious") %>%
    group_by(Vrid) %>%
    summarise(flags = sum(value)) %>%
    count(flags) %>%
    mutate(cumulative_n = cumsum(n)) %>%
    knitr::kable()
```

### Missing Responses

```{r}
flags$flag_values %>%
    filter(group == "incomplete") %>%
    group_by(Vrid) %>%
    summarise(flags = sum(value)) %>%
    count(flags) %>%
    mutate(cumulative_n = cumsum(n)) %>%
    knitr::kable()
```

### Additional Suspicious Flags

```{r}
flags$flag_values %>%
    filter(group == "suspicious") %>%
    group_by(Vrid) %>%
    summarise(flags = sum(value)) %>%
    count(flags) %>%
    mutate(cumulative_n = cumsum(n)) %>%
    knitr::kable()
```

### All Flags

```{r}
flags$flag_values %>%
    group_by(Vrid) %>%
    summarise(flags = sum(value)) %>%
    count(flags) %>%
    arrange(desc(flags)) %>%
    mutate(cumulative_n = cumsum(n)) %>%
    knitr::kable()
```
